<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009"
		xmlns:s="library://ns.adobe.com/flex/spark"
		add="viewAddHandler(event)" title="Record">
	<fx:Declarations>
		<!-- 非ビジュアルエレメント (サービス、値オブジェクトなど) をここに配置 -->
	</fx:Declarations>
	<fx:Script>
	<![CDATA[
		import models.MainModel;
		
		import mx.events.FlexEvent;
		
		import spark.components.supportClasses.ViewReturnObject;
		import spark.events.TextOperationEvent;
		import spark.transitions.SlideViewTransition;
		import spark.transitions.ViewTransitionDirection;
		
		private function backButtonClickHandler(event:MouseEvent):void
		{
			this.navigator.popView();
		}
			
		private function editButtonClickHandler(event:MouseEvent):void
		{
			this.navigator.pushView(EditRecordView, data);
		}
			
		public override function createReturnObject():Object{
			return data;
		}
		
		private function viewAddHandler(event:Event):void
		{
			var file:File;
			
			// popで遷移してきたのかpushで遷移してきたのか判定
			var o:ViewReturnObject = navigator.poppedViewReturnedObject;
			if (o != null)
			{ // popで遷移してきた
				file = o.object as File;
			}
			else if (data != null) // popで遷移してきた
			{
				file = data as File;
			}
			else
			{ //アプリ再開がこの画面のときはpoppedViewReturnedObjectとdataはnullになっている。またpopであってもnullがかえってきたとき。
				// do nothing
				return;
			}
		
			recordNameTextInput.text = MainModel.getInstance().getRecordName(file);
			commentTextArea.text = MainModel.getInstance().getComment(file);
			creationDateLabel.text = file.creationDate.toLocaleString();
		}
		
		private function playButtonClickHandler(event:MouseEvent):void
		{
			this.navigator.popToFirstView();
		}
		
		// TODO:削除時には確認ダイアログが必要
		private function deleteButtonClickHandler(event:MouseEvent):void
		{
			if (data != null) // アプリ再開がこの画面のときはdataはnullになっている
			{
				var recordName:String = MainModel.getInstance().getRecordName(data as File);
				MainModel.getInstance().deleteRecord(recordName);
			}
			this.navigator.popView();
		}
	]]>
	</fx:Script>
	<s:navigationContent>
		<s:Button label="Back" click="backButtonClickHandler(event)"/>
	</s:navigationContent>
	<s:actionContent>
		<s:Button label="Edit" click="editButtonClickHandler(event)"/>
	</s:actionContent>
	<s:layout>
		<s:VerticalLayout gap="20" horizontalAlign="left" paddingBottom="10" paddingLeft="10"
						  paddingRight="10" paddingTop="10"/>
	</s:layout>
	<s:Label text="Record Name :" textAlign="left"/>
	<s:TextInput id="recordNameTextInput" width="100%" borderVisible="false"
				 editable="false"/>
	<s:Label text="Creation Date :" textAlign="left"/>
	<!-- データバインディング使いたいが、アプリ再開がこの画面のときはdataはnullなので。方法未調査
	<s:Label id="creationDateLabel" text="{(data as File).creationDate.toLocaleString()}" textAlign="left"/>
	-->
	<s:Label id="creationDateLabel" width="100%" textAlign="center"/>
	<s:Label text="Comment :" textAlign="left"/>
	<s:TextArea id="commentTextArea" width="100%" height="120" borderVisible="false"
				editable="false"/>
	<s:HGroup gap="20" horizontalAlign="center">
		<s:Button id="playButton" width="90" height="25" label="PLAY" cacheAsBitmap="true"
				  click="playButtonClickHandler(event)" fontSize="12" fontStyle="normal"
				  fontWeight="bold"/>
		<!-- TODO 3D機能はいずれ作る
		<s:Button id="play3dButton" width="90" height="25" label="PLAY 3D" cacheAsBitmap="true"
				  fontSize="12" fontStyle="normal" fontWeight="bold"/>
		-->
		<s:Button id="deleteButton" width="90" height="25" label="DELETE" cacheAsBitmap="true"
				  click="deleteButtonClickHandler(event)" fontSize="12" fontStyle="normal"
				  fontWeight="bold"/>
	</s:HGroup>
</s:View>
