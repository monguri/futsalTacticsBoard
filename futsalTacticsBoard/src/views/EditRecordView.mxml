<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009"
		xmlns:s="library://ns.adobe.com/flex/spark"
		add="viewAddHandler(event)"
		title="EditRecord">
	<fx:Declarations>
		<!-- 非ビジュアルエレメント (サービス、値オブジェクトなど) をここに配置 -->
	</fx:Declarations>
	<fx:Script>
	<![CDATA[
		import models.MainModel;
		
		import mx.events.FlexEvent;
		
		import spark.events.TextOperationEvent;
		import spark.transitions.SlideViewTransition;
		import spark.transitions.SlideViewTransitionMode;
		import spark.transitions.ViewTransitionDirection;
		
		private function cancelButtonClickHandler(event:MouseEvent):void
		{
			var v:SlideViewTransition = new SlideViewTransition();
			v.mode = SlideViewTransitionMode.UNCOVER;
			v.direction = ViewTransitionDirection.DOWN;
			this.navigator.popView(v);
		}
			
		private function doneButtonClickHandler(event:MouseEvent):void
		{
			if (data != null) // アプリ再開がこの画面のときはdataはnullになっている
			{
				// setCommentをsetRecordNameより先にする。
				// setRecordNameによりファイルの実体のファイル名が変わってしまい、dataの中のパスでは参照できなくなる。
				MainModel.getInstance().setComment((data as File), commentTextArea.text);
				MainModel.getInstance().setRecordName((data as File), recordNameTextInput.text);

				var v:SlideViewTransition = new SlideViewTransition();
				v.mode = SlideViewTransitionMode.UNCOVER;
				v.direction = ViewTransitionDirection.DOWN;
				this.navigator.popView(v);
			}
		}
			
		public override function createReturnObject():Object{
			// ファイル名を変更するとdataに入っているパスは古くなっているので、Fileインスタンスを作り直す。
			var file:File = MainModel.getInstance().getRecord(recordNameTextInput.text);
			return file;
		}
		
		private function viewAddHandler(event:Event):void
		{
			if (data != null) // アプリ再開がこの画面のときはdataはnullになっている
			{
				var file:File = data as File;
				recordNameTextInput.text = MainModel.getInstance().getRecordName(file);
				commentTextArea.text = MainModel.getInstance().getComment(file);
				creationDateLabel.text = file.creationDate.toLocaleString();
			}
		}
	]]>
	</fx:Script>
	<s:navigationContent>
		<s:Button label="Cancel" click="cancelButtonClickHandler(event)"/>
	</s:navigationContent>
	<s:actionContent>
		<s:Button label="Done" click="doneButtonClickHandler(event)"/>
	</s:actionContent>
	<s:layout>
		<s:VerticalLayout gap="20" horizontalAlign="left" paddingBottom="10" paddingLeft="10"
						  paddingRight="10" paddingTop="10"/>
	</s:layout>
	<s:Label text="Record Name :" textAlign="left"/>
	<s:TextInput id="recordNameTextInput" width="100%" prompt="Record Name" />
	<s:Label text="Creation Date :" textAlign="left"/>
	<!-- データバインディング使いたいが、アプリ再開がこの画面のときはdataはnullなので。方法未調査
	<s:Label id="creationDateLabel" text="{(data as File).creationDate.toLocaleString()}" textAlign="left"/>
	-->
	<s:Label id="creationDateLabel" width="100%" textAlign="center"/>
	<s:Label text="Comment :" textAlign="left"/>
	<s:TextArea id="commentTextArea" width="100%" prompt="Comment" height="120" />
</s:View>
